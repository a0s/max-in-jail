# Max Messenger Android Setup Script

Автоматизированный bash-скрипт для установки и запуска мессенджера Max в Android эмуляторе на macOS.

## Возможности

- **Автоматическая установка всех зависимостей** через Homebrew
- Автоматическая установка Android SDK Command Line Tools
- Создание и управление Android Virtual Device (AVD)
- **Автоматическая проверка новых версий** APK в RuStore
- Автоматическое скачивание последней версии Max Messenger
- Установка и запуск приложения
- Сохранение данных между запусками
- **Идемпотентность** - скрипт можно запускать многократно без побочных эффектов
- **Модульная архитектура** - код разбит на логические модули
- **Централизованное хранение данных** - все данные в `~/.cache/max-in-box/` для легкой очистки
- **Режимы работы**: foreground (логи в консоли, Ctrl+C останавливает) и detach (скрипт завершается, эмулятор работает)

## Архитектура

### Структура проекта

```
max-in-box/
├── max-in-box.sh    # Основной скрипт
├── README.md        # Документация
└── lib/             # Модули скрипта
    ├── utils.sh           # Утилиты (логирование, проверки)
    ├── dependencies.sh    # Управление зависимостями
    ├── android_sdk.sh     # Работа с Android SDK
    ├── avd.sh             # Управление AVD
    ├── apk.sh             # Скачивание APK
    └── app.sh             # Установка и запуск приложения

~/.cache/max-in-box/       # Все данные скрипта (создается автоматически)
├── android-sdk/            # Android SDK (полная установка)
├── apk/                    # Скачанные APK файлы
├── avd/                    # Android Virtual Devices
└── logs/                   # Лог файлы
```

### Модули

- **utils.sh** - Общие утилиты: логирование, проверка команд, работа с Homebrew, работа с файлами
- **dependencies.sh** - Автоматическая установка зависимостей (Homebrew, Java, Python 3)
- **android_sdk.sh** - Установка и настройка Android SDK Command Line Tools, установка компонентов SDK
- **avd.sh** - Создание и управление Android Virtual Device, запуск эмулятора, ожидание готовности
- **apk.sh** - Скачивание APK из различных источников (APKMirror, APKPure, Google Play через apkeep)
- **app.sh** - Установка приложения через ADB, запуск приложения

### Принципы

- **Идемпотентность**: Все функции проверяют состояние перед выполнением действий
- **Модульность**: Каждый модуль отвечает за свою область ответственности
- **Автоматизация**: Минимум ручных действий, все зависимости устанавливаются автоматически
- **Кроссплатформенность**: Автоматическое определение архитектуры (x86_64/arm64) для Apple Silicon
- **Легкая очистка**: Все данные хранятся в `~/.cache/max-in-box/` - удалите эту папку для полной очистки

## Использование

### Обычный запуск (foreground mode)
```bash
./max-in-box.sh
```
Скрипт запускает эмулятор, устанавливает приложение и начинает показывать логи эмулятора в консоли. Нажмите `Ctrl+C` для остановки эмулятора и выхода.

### Запуск в фоне (detach mode)
```bash
./max-in-box.sh --detach
```
Скрипт запускает эмулятор и завершается, эмулятор продолжает работать в фоне.

### Удаление всех данных
```bash
./max-in-box.sh --uninstall
```
Удаляет все данные, созданные скриптом (Android SDK, AVD, APK файлы, логи).

### Справка
```bash
./max-in-box.sh --help
```

## Особенности работы

- **Проверка версий**: При каждом запуске скрипт проверяет наличие новой версии APK в RuStore и скачивает её при необходимости
- **Работа с запущенным эмулятором**: Если эмулятор уже запущен, скрипт использует существующий экземпляр
- **Идемпотентность**: Можно запускать скрипт многократно - он проверяет состояние и выполняет только необходимые действия

## Очистка данных

Все данные, созданные скриптом, хранятся в `~/.cache/max-in-box/`. Для полной очистки:

```bash
# Способ 1: Использовать встроенную команду
./max-in-box.sh --uninstall

# Способ 2: Удалить директорию вручную
rm -rf ~/.cache/max-in-box
```

**Примечание**: Установленные зависимости через Homebrew (Java, Python, jq, pv) не удаляются автоматически, так как могут использоваться другими приложениями.
